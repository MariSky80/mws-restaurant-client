{"version":3,"sources":["node_modules/browser-pack/_prelude.js","node_modules/idb/lib/idb.js","sw.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;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","file":"sw.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","'use strict';\n\n(function() {\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function(resolve, reject) {\n      request.onsuccess = function() {\n        resolve(request.result);\n      };\n\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function(resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function(value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function(prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function() {\n          return this[targetProp][prop];\n        },\n        set: function(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function() {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function() {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function(value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function() {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function() {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getKey',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function(resolve, reject) {\n      idbTransaction.oncomplete = function() {\n        resolve();\n      };\n      idbTransaction.onerror = function() {\n        reject(idbTransaction.error);\n      };\n      idbTransaction.onabort = function() {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function() {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function() {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function() {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n    [ObjectStore, Index].forEach(function(Constructor) {\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function() {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function(Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function(query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function(resolve) {\n        instance.iterateCursor(query, function(cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  var exp = {\n    open: function(name, version, upgradeCallback) {\n      var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n      var request = p.request;\n\n      request.onupgradeneeded = function(event) {\n        if (upgradeCallback) {\n          upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n        }\n      };\n\n      return p.then(function(db) {\n        return new DB(db);\n      });\n    },\n    delete: function(name) {\n      return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n    }\n  };\n\n  if (typeof module !== 'undefined') {\n    module.exports = exp;\n    module.exports.default = module.exports;\n  }\n  else {\n    self.idb = exp;\n  }\n}());\n","const idb = require('idb');\nconst IDB_DB = 'restaurant-db';\nconst IDB_RESTAURANTS = 'restaurants';\nconst IDB_PENDING_RESTAURANTS = 'pending_restaurants';\nconst IDB_REVIEWS = 'reviews';\nconst IDB_PENDING_REVIEWS = 'pending_reviews';\n\nconst dbPromise = idb.open(IDB_DB, 2, function (upgradeDb) {\n  switch (upgradeDb.oldVersion) {\n    case 0:\n    case 1:\n    case 2:\n      const storeRestaurant = upgradeDb.createObjectStore(IDB_RESTAURANTS, {\n        keyPath: 'id'\n      });\n      storeRestaurant.createIndex('by-id', 'id', { unique: true });\n\n      const storeReviews = upgradeDb.createObjectStore(IDB_REVIEWS, {\n        keyPath: 'id'\n      });\n      //storeReviews.createIndex('by-id', 'id', { unique: true });\n      storeReviews.createIndex('by-restaurant-id', 'restaurant_id');\n\n      const pendingRestaurants = upgradeDb.createObjectStore(IDB_PENDING_RESTAURANTS, {\n        keyPath: 'id'\n      });\n      pendingRestaurants.createIndex('by-id', 'id', {unique:true});\n\n      const pendingReviews = upgradeDb.createObjectStore(IDB_PENDING_REVIEWS, {\n        keyPath:'id', autoIncrement:true\n      });\n      pendingReviews.createIndex('by-id', 'id', {unique:true});\n  }\n});\n\nconst staticCacheName = 'mws-restaurant-stage-3';\n\nlet filesToCache = [\n  '/',\n  'manifest.json',\n  'index.html',\n  'restaurant.html',\n  'css/main.css',\n  'css/detail.css',\n  'js/bundle_main.js',\n  'js/bundle_restaurant.js',\n  'sw.js',\n  'img/favicon/apple-icon-57x57.png',\n  'img/favicon/apple-icon-60x60.png',\n  'img/favicon/apple-icon-72x72.png',\n  'img/favicon/apple-icon-76x76.png',\n  'img/favicon/apple-icon-114x114.png',\n  'img/favicon/apple-icon-120x120.png',\n  'img/favicon/apple-icon-144x144.png',\n  'img/favicon/apple-icon-152x152.png',\n  'img/favicon/apple-icon-180x180.png',\n  'img/favicon/android-icon-192x192.png',\n  'img/favicon/favicon-32x32.png',\n  'img/favicon/favicon-96x96.png',\n  'img/favicon/favicon-16x16.png',\n  'img/favicon/ms-icon-144x144.png',\n  'img/favicon/ms-icon-70x70.png',\n  'img/favicon/ms-icon-150x150.png',\n  'img/favicon/ms-icon-310x310.png',\n  'img/favicon/android-icon-512x512.png',\n  'img/favicon/favicon.ico',\n  'img/1-380_small.jpg',\n  'img/1-512_medium.jpg',\n  'img/1-800_large.jpg',\n  'img/2-380_small.jpg',\n  'img/2-512_medium.jpg',\n  'img/2-800_large.jpg',\n  'img/3-380_small.jpg',\n  'img/3-512_medium.jpg',\n  'img/3-800_large.jpg',\n  'img/4-380_small.jpg',\n  'img/4-512_medium.jpg',\n  'img/4-800_large.jpg',\n  'img/5-380_small.jpg',\n  'img/5-512_medium.jpg',\n  'img/5-800_large.jpg',\n  'img/6-380_small.jpg',\n  'img/6-512_medium.jpg',\n  'img/6-800_large.jpg',\n  'img/7-380_small.jpg',\n  'img/7-512_medium.jpg',\n  'img/7-800_large.jpg',\n  'img/8-380_small.jpg',\n  'img/8-512_medium.jpg',\n  'img/8-800_large.jpg',\n  'img/9-380_small.jpg',\n  'img/9-512_medium.jpg',\n  'img/9-800_large.jpg',\n  'img/10-380_small.jpg',\n  'img/10-512_medium.jpg',\n  'img/10-800_large.jpg',\n];\n\n\nself.addEventListener('install', function(event) {\n  event.waitUntil(\n    caches.open(staticCacheName).then(function(cache) {\n      return cache.addAll(filesToCache);\n    })\n  );\n});\n\n\nself.addEventListener('activate', function(event) {\n  event.waitUntil(\n    caches.keys().then(function(cacheNames) {\n      return Promise.all(\n        cacheNames.filter(function(cacheName) {\n          return cacheName.startsWith('mws-') &&\n                 cacheName != staticCacheName;\n        }).map(function(cacheName) {\n          return caches.delete(cacheName);\n        })\n      ).then(() => { console.log('Service worker active');} );\n    })\n  );\n});\n\n\nself.addEventListener('fetch', function(event) {\n  event.respondWith(\n    caches.match(event.request).then(function(response) {\n      return response || fetch(event.request);\n    })\n  );\n});\n\n\nself.addEventListener('message', function(event) {\n  if (event.data.action === 'skipWaiting') {\n    self.skipWaiting();\n  }\n});\n\n\n//Based on https://github.com/WICG/BackgroundSync/blob/master/explainer.md\nself.addEventListener('sync', function(event) {\n  switch(event.tag) {\n    case 'review':  event.waitUntil(sendAllReviews());\n      break;\n    case 'favorite': event.waitUntil(sendAllFavorites());\n      break;\n  }\n});\n\n\n/**\n * @description  Send review to server and stores it at database.\n * @constructor\n * @param {object} review - Reviwe object.\n * @param {function} callback - Callback function.\n */\nfunction postReview(review) {\n  return fetch(`http://localhost:1337/reviews`,\n    {\n      method:'post',\n      headers: {\n        Accept: \"application/json, text/plain, */*\",\n        \"Content-Type\": \"application/json\"\n      },\n      body:JSON.stringify(review)\n    })\n    .then(response => response.json())\n    .then(review => console.log(review));\n}\n\n\n/**\n * @description  Send review to server and stores it at database.\n * @constructor\n * @param {object} review - Reviwe object.\n * @param {function} callback - Callback function.\n */\nfunction putFavorite(favorite) {\n  return fetch(`http://localhost:1337/restaurants/${favorite.restaurant_id}/?is_favorite=${favorite.is_favorite}`,\n    {\n      method:'put',\n      headers: {\n        Accept: \"application/json, text/plain, */*\",\n        \"Content-Type\": \"application/json\"\n      },\n      body:JSON.stringify(favorite)\n    })\n    .then(response => response.json())\n    .then(favorite => console.log(favorite));\n}\n\n\n/**\n * @description  Send all reviews to server\n * @constructor\n */\nfunction sendAllReviews() {\n  dbPromise.then( db => {\n    if(!db) return;\n    return db.transaction(IDB_PENDING_REVIEWS)\n             .objectStore(IDB_PENDING_REVIEWS)\n             .getAll();\n  })\n  .then(reviews => {\n    const reviewList = [];\n    reviews.forEach(function(review) {\n      let rev = {\n        'restaurant_id': review.restaurant_id,\n        'name': review.name,\n        'rating': review.rating,\n        'comments': review.comments,\n        'createdAt': review.createdAt,\n        'updatedAt': review.updatedAt\n      };\n      reviewList.push(postReview(rev));\n    });\n    return Promise.all(reviewList);\n  })\n  .then(reviews => {\n    dbPromise.then( db => {\n      if(!db) return;\n      const clear = db.transaction(IDB_PENDING_REVIEWS, \"readwrite\");\n      clear.objectStore(IDB_PENDING_REVIEWS).clear();\n      return clear.complete;\n    })\n  })\n  .catch(error => {\n    console.error(error);\n  })\n}\n\n\n/**\n * @description  Send all reviews to server\n * @constructor\n */\nfunction sendAllFavorites() {\n  dbPromise.then( db => {\n    if(!db) return;\n    return db.transaction(IDB_PENDING_RESTAURANTS)\n             .objectStore(IDB_PENDING_RESTAURANTS)\n             .getAll();\n  })\n  .then(favorites => {\n    const favoriteList = [];\n    favorites.forEach(function(favorite) {\n      favoriteList.push(putFavorite(favorite));\n    });\n    return Promise.all(favoriteList);\n  })\n  .then(favorites => {\n    dbPromise.then( db => {\n      if(!db) return;\n      const clear = db.transaction(IDB_PENDING_RESTAURANTS, \"readwrite\");\n      clear.objectStore(IDB_PENDING_RESTAURANTS).clear();\n      return clear.complete;\n    })\n  })\n  .catch(error => {\n    console.error(error);\n  })\n}\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvaWRiL2xpYi9pZGIuanMiLCJzdy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2VEEsTUFBTSxNQUFNLFFBQVEsS0FBUixDQUFaO0FBQ0EsTUFBTSxTQUFTLGVBQWY7QUFDQSxNQUFNLGtCQUFrQixhQUF4QjtBQUNBLE1BQU0sMEJBQTBCLHFCQUFoQztBQUNBLE1BQU0sY0FBYyxTQUFwQjtBQUNBLE1BQU0sc0JBQXNCLGlCQUE1Qjs7QUFFQSxNQUFNLFlBQVksSUFBSSxJQUFKLENBQVMsTUFBVCxFQUFpQixDQUFqQixFQUFvQixVQUFVLFNBQVYsRUFBcUI7QUFDekQsVUFBUSxVQUFVLFVBQWxCO0FBQ0UsU0FBSyxDQUFMO0FBQ0EsU0FBSyxDQUFMO0FBQ0EsU0FBSyxDQUFMO0FBQ0UsWUFBTSxrQkFBa0IsVUFBVSxpQkFBVixDQUE0QixlQUE1QixFQUE2QztBQUNuRSxpQkFBUztBQUQwRCxPQUE3QyxDQUF4QjtBQUdBLHNCQUFnQixXQUFoQixDQUE0QixPQUE1QixFQUFxQyxJQUFyQyxFQUEyQyxFQUFFLFFBQVEsSUFBVixFQUEzQzs7QUFFQSxZQUFNLGVBQWUsVUFBVSxpQkFBVixDQUE0QixXQUE1QixFQUF5QztBQUM1RCxpQkFBUztBQURtRCxPQUF6QyxDQUFyQjtBQUdBO0FBQ0EsbUJBQWEsV0FBYixDQUF5QixrQkFBekIsRUFBNkMsZUFBN0M7O0FBRUEsWUFBTSxxQkFBcUIsVUFBVSxpQkFBVixDQUE0Qix1QkFBNUIsRUFBcUQ7QUFDOUUsaUJBQVM7QUFEcUUsT0FBckQsQ0FBM0I7QUFHQSx5QkFBbUIsV0FBbkIsQ0FBK0IsT0FBL0IsRUFBd0MsSUFBeEMsRUFBOEMsRUFBQyxRQUFPLElBQVIsRUFBOUM7O0FBRUEsWUFBTSxpQkFBaUIsVUFBVSxpQkFBVixDQUE0QixtQkFBNUIsRUFBaUQ7QUFDdEUsaUJBQVEsSUFEOEQsRUFDeEQsZUFBYztBQUQwQyxPQUFqRCxDQUF2QjtBQUdBLHFCQUFlLFdBQWYsQ0FBMkIsT0FBM0IsRUFBb0MsSUFBcEMsRUFBMEMsRUFBQyxRQUFPLElBQVIsRUFBMUM7QUF2Qko7QUF5QkQsQ0ExQmlCLENBQWxCOztBQTRCQSxNQUFNLGtCQUFrQix3QkFBeEI7O0FBRUEsSUFBSSxlQUFlLENBQ2pCLEdBRGlCLEVBRWpCLGVBRmlCLEVBR2pCLFlBSGlCLEVBSWpCLGlCQUppQixFQUtqQixjQUxpQixFQU1qQixnQkFOaUIsRUFPakIsbUJBUGlCLEVBUWpCLHlCQVJpQixFQVNqQixPQVRpQixFQVVqQixrQ0FWaUIsRUFXakIsa0NBWGlCLEVBWWpCLGtDQVppQixFQWFqQixrQ0FiaUIsRUFjakIsb0NBZGlCLEVBZWpCLG9DQWZpQixFQWdCakIsb0NBaEJpQixFQWlCakIsb0NBakJpQixFQWtCakIsb0NBbEJpQixFQW1CakIsc0NBbkJpQixFQW9CakIsK0JBcEJpQixFQXFCakIsK0JBckJpQixFQXNCakIsK0JBdEJpQixFQXVCakIsaUNBdkJpQixFQXdCakIsK0JBeEJpQixFQXlCakIsaUNBekJpQixFQTBCakIsaUNBMUJpQixFQTJCakIsc0NBM0JpQixFQTRCakIseUJBNUJpQixFQTZCakIscUJBN0JpQixFQThCakIsc0JBOUJpQixFQStCakIscUJBL0JpQixFQWdDakIscUJBaENpQixFQWlDakIsc0JBakNpQixFQWtDakIscUJBbENpQixFQW1DakIscUJBbkNpQixFQW9DakIsc0JBcENpQixFQXFDakIscUJBckNpQixFQXNDakIscUJBdENpQixFQXVDakIsc0JBdkNpQixFQXdDakIscUJBeENpQixFQXlDakIscUJBekNpQixFQTBDakIsc0JBMUNpQixFQTJDakIscUJBM0NpQixFQTRDakIscUJBNUNpQixFQTZDakIsc0JBN0NpQixFQThDakIscUJBOUNpQixFQStDakIscUJBL0NpQixFQWdEakIsc0JBaERpQixFQWlEakIscUJBakRpQixFQWtEakIscUJBbERpQixFQW1EakIsc0JBbkRpQixFQW9EakIscUJBcERpQixFQXFEakIscUJBckRpQixFQXNEakIsc0JBdERpQixFQXVEakIscUJBdkRpQixFQXdEakIsc0JBeERpQixFQXlEakIsdUJBekRpQixFQTBEakIsc0JBMURpQixDQUFuQjs7QUE4REEsS0FBSyxnQkFBTCxDQUFzQixTQUF0QixFQUFpQyxVQUFTLEtBQVQsRUFBZ0I7QUFDL0MsUUFBTSxTQUFOLENBQ0UsT0FBTyxJQUFQLENBQVksZUFBWixFQUE2QixJQUE3QixDQUFrQyxVQUFTLEtBQVQsRUFBZ0I7QUFDaEQsV0FBTyxNQUFNLE1B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QUFHLFdBQUgsQ0FBZSx1QkFBZixFQUF3QyxXQUF4QyxDQUFkO0FBQ0EsWUFBTSxXQUFOLENBQWtCLHVCQUFsQixFQUEyQyxLQUEzQztBQUNBLGFBQU8sTUFBTSxRQUFiO0FBQ0QsS0FMRDtBQU1ELEdBcEJELEVBcUJDLEtBckJELENBcUJPLFNBQVM7QUFDZCxZQUFRLEtBQVIsQ0FBYyxLQUFkO0FBQ0QsR0F2QkQ7QUF3QkQiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbigpIHtcbiAgZnVuY3Rpb24gdG9BcnJheShhcnIpIHtcbiAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJyKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3QocmVxdWVzdCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlc29sdmUocmVxdWVzdC5yZXN1bHQpO1xuICAgICAgfTtcblxuICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlamVjdChyZXF1ZXN0LmVycm9yKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncykge1xuICAgIHZhciByZXF1ZXN0O1xuICAgIHZhciBwID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICByZXF1ZXN0ID0gb2JqW21ldGhvZF0uYXBwbHkob2JqLCBhcmdzKTtcbiAgICAgIHByb21pc2lmeVJlcXVlc3QocmVxdWVzdCkudGhlbihyZXNvbHZlLCByZWplY3QpO1xuICAgIH0pO1xuXG4gICAgcC5yZXF1ZXN0ID0gcmVxdWVzdDtcbiAgICByZXR1cm4gcDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeUN1cnNvclJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKSB7XG4gICAgdmFyIHAgPSBwcm9taXNpZnlSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncyk7XG4gICAgcmV0dXJuIHAudGhlbihmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuO1xuICAgICAgcmV0dXJuIG5ldyBDdXJzb3IodmFsdWUsIHAucmVxdWVzdCk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eVByb3BlcnRpZXMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUHJveHlDbGFzcy5wcm90b3R5cGUsIHByb3AsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gdGhpc1t0YXJnZXRQcm9wXVtwcm9wXTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbih2YWwpIHtcbiAgICAgICAgICB0aGlzW3RhcmdldFByb3BdW3Byb3BdID0gdmFsO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5UmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdENhbGwodGhpc1t0YXJnZXRQcm9wXSwgcHJvcCwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eU1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpc1t0YXJnZXRQcm9wXVtwcm9wXS5hcHBseSh0aGlzW3RhcmdldFByb3BdLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgaWYgKCEocHJvcCBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5Q3Vyc29yUmVxdWVzdENhbGwodGhpc1t0YXJnZXRQcm9wXSwgcHJvcCwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBJbmRleChpbmRleCkge1xuICAgIHRoaXMuX2luZGV4ID0gaW5kZXg7XG4gIH1cblxuICBwcm94eVByb3BlcnRpZXMoSW5kZXgsICdfaW5kZXgnLCBbXG4gICAgJ25hbWUnLFxuICAgICdrZXlQYXRoJyxcbiAgICAnbXVsdGlFbnRyeScsXG4gICAgJ3VuaXF1ZSdcbiAgXSk7XG5cbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhJbmRleCwgJ19pbmRleCcsIElEQkluZGV4LCBbXG4gICAgJ2dldCcsXG4gICAgJ2dldEtleScsXG4gICAgJ2dldEFsbCcsXG4gICAgJ2dldEFsbEtleXMnLFxuICAgICdjb3VudCdcbiAgXSk7XG5cbiAgcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhJbmRleCwgJ19pbmRleCcsIElEQkluZGV4LCBbXG4gICAgJ29wZW5DdXJzb3InLFxuICAgICdvcGVuS2V5Q3Vyc29yJ1xuICBdKTtcblxuICBmdW5jdGlvbiBDdXJzb3IoY3Vyc29yLCByZXF1ZXN0KSB7XG4gICAgdGhpcy5fY3Vyc29yID0gY3Vyc29yO1xuICAgIHRoaXMuX3JlcXVlc3QgPSByZXF1ZXN0O1xuICB9XG5cbiAgcHJveHlQcm9wZXJ0aWVzKEN1cnNvciwgJ19jdXJzb3InLCBbXG4gICAgJ2RpcmVjdGlvbicsXG4gICAgJ2tleScsXG4gICAgJ3ByaW1hcnlLZXknLFxuICAgICd2YWx1ZSdcbiAgXSk7XG5cbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhDdXJzb3IsICdfY3Vyc29yJywgSURCQ3Vyc29yLCBbXG4gICAgJ3VwZGF0ZScsXG4gICAgJ2RlbGV0ZSdcbiAgXSk7XG5cbiAgLy8gcHJveHkgJ25leHQnIG1ldGhvZHNcbiAgWydhZHZhbmNlJywgJ2NvbnRpbnVlJywgJ2NvbnRpbnVlUHJpbWFyeUtleSddLmZvckVhY2goZnVuY3Rpb24obWV0aG9kTmFtZSkge1xuICAgIGlmICghKG1ldGhvZE5hbWUgaW4gSURCQ3Vyc29yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICBDdXJzb3IucHJvdG90eXBlW21ldGhvZE5hbWVdID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgY3Vyc29yID0gdGhpcztcbiAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgIGN1cnNvci5fY3Vyc29yW21ldGhvZE5hbWVdLmFwcGx5KGN1cnNvci5fY3Vyc29yLCBhcmdzKTtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3QoY3Vyc29yLl9yZXF1ZXN0KS50aGVuKGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuO1xuICAgICAgICAgIHJldHVybiBuZXcgQ3Vyc29yKHZhbHVlLCBjdXJzb3IuX3JlcXVlc3QpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIE9iamVjdFN0b3JlKHN0b3JlKSB7XG4gICAgdGhpcy5fc3RvcmUgPSBzdG9yZTtcbiAgfVxuXG4gIE9iamVjdFN0b3JlLnByb3RvdHlwZS5jcmVhdGVJbmRleCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgSW5kZXgodGhpcy5fc3RvcmUuY3JlYXRlSW5kZXguYXBwbHkodGhpcy5fc3RvcmUsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIE9iamVjdFN0b3JlLnByb3RvdHlwZS5pbmRleCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgSW5kZXgodGhpcy5fc3RvcmUuaW5kZXguYXBwbHkodGhpcy5fc3RvcmUsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIFtcbiAgICAnbmFtZScsXG4gICAgJ2tleVBhdGgnLFxuICAgICdpbmRleE5hbWVzJyxcbiAgICAnYXV0b0luY3JlbWVudCdcbiAgXSk7XG5cbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXG4gICAgJ3B1dCcsXG4gICAgJ2FkZCcsXG4gICAgJ2RlbGV0ZScsXG4gICAgJ2NsZWFyJyxcbiAgICAnZ2V0JyxcbiAgICAnZ2V0QWxsJyxcbiAgICAnZ2V0S2V5JyxcbiAgICAnZ2V0QWxsS2V5cycsXG4gICAgJ2NvdW50J1xuICBdKTtcblxuICBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcbiAgICAnb3BlbkN1cnNvcicsXG4gICAgJ29wZW5LZXlDdXJzb3InXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXG4gICAgJ2RlbGV0ZUluZGV4J1xuICBdKTtcblxuICBmdW5jdGlvbiBUcmFuc2FjdGlvbihpZGJUcmFuc2FjdGlvbikge1xuICAgIHRoaXMuX3R4ID0gaWRiVHJhbnNhY3Rpb247XG4gICAgdGhpcy5jb21wbGV0ZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25jb21wbGV0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXNvbHZlKCk7XG4gICAgICB9O1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZWplY3QoaWRiVHJhbnNhY3Rpb24uZXJyb3IpO1xuICAgICAgfTtcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uYWJvcnQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVqZWN0KGlkYlRyYW5zYWN0aW9uLmVycm9yKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBUcmFuc2FjdGlvbi5wcm90b3R5cGUub2JqZWN0U3RvcmUgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IE9iamVjdFN0b3JlKHRoaXMuX3R4Lm9iamVjdFN0b3JlLmFwcGx5KHRoaXMuX3R4LCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoVHJhbnNhY3Rpb24sICdfdHgnLCBbXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnLFxuICAgICdtb2RlJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoVHJhbnNhY3Rpb24sICdfdHgnLCBJREJUcmFuc2FjdGlvbiwgW1xuICAgICdhYm9ydCdcbiAgXSk7XG5cbiAgZnVuY3Rpb24gVXBncmFkZURCKGRiLCBvbGRWZXJzaW9uLCB0cmFuc2FjdGlvbikge1xuICAgIHRoaXMuX2RiID0gZGI7XG4gICAgdGhpcy5vbGRWZXJzaW9uID0gb2xkVmVyc2lvbjtcbiAgICB0aGlzLnRyYW5zYWN0aW9uID0gbmV3IFRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uKTtcbiAgfVxuXG4gIFVwZ3JhZGVEQi5wcm90b3R5cGUuY3JlYXRlT2JqZWN0U3RvcmUgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IE9iamVjdFN0b3JlKHRoaXMuX2RiLmNyZWF0ZU9iamVjdFN0b3JlLmFwcGx5KHRoaXMuX2RiLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoVXBncmFkZURCLCAnX2RiJywgW1xuICAgICduYW1lJyxcbiAgICAndmVyc2lvbicsXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhVcGdyYWRlREIsICdfZGInLCBJREJEYXRhYmFzZSwgW1xuICAgICdkZWxldGVPYmplY3RTdG9yZScsXG4gICAgJ2Nsb3NlJ1xuICBdKTtcblxuICBmdW5jdGlvbiBEQihkYikge1xuICAgIHRoaXMuX2RiID0gZGI7XG4gIH1cblxuICBEQi5wcm90b3R5cGUudHJhbnNhY3Rpb24gPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IFRyYW5zYWN0aW9uKHRoaXMuX2RiLnRyYW5zYWN0aW9uLmFwcGx5KHRoaXMuX2RiLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoREIsICdfZGInLCBbXG4gICAgJ25hbWUnLFxuICAgICd2ZXJzaW9uJyxcbiAgICAnb2JqZWN0U3RvcmVOYW1lcydcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKERCLCAnX2RiJywgSURCRGF0YWJhc2UsIFtcbiAgICAnY2xvc2UnXG4gIF0pO1xuXG4gIC8vIEFkZCBjdXJzb3IgaXRlcmF0b3JzXG4gIC8vIFRPRE86IHJlbW92ZSB0aGlzIG9uY2UgYnJvd3NlcnMgZG8gdGhlIHJpZ2h0IHRoaW5nIHdpdGggcHJvbWlzZXNcbiAgWydvcGVuQ3Vyc29yJywgJ29wZW5LZXlDdXJzb3InXS5mb3JFYWNoKGZ1bmN0aW9uKGZ1bmNOYW1lKSB7XG4gICAgW09iamVjdFN0b3JlLCBJbmRleF0uZm9yRWFjaChmdW5jdGlvbihDb25zdHJ1Y3Rvcikge1xuICAgICAgQ29uc3RydWN0b3IucHJvdG90eXBlW2Z1bmNOYW1lLnJlcGxhY2UoJ29wZW4nLCAnaXRlcmF0ZScpXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgYXJncyA9IHRvQXJyYXkoYXJndW1lbnRzKTtcbiAgICAgICAgdmFyIGNhbGxiYWNrID0gYXJnc1thcmdzLmxlbmd0aCAtIDFdO1xuICAgICAgICB2YXIgbmF0aXZlT2JqZWN0ID0gdGhpcy5fc3RvcmUgfHwgdGhpcy5faW5kZXg7XG4gICAgICAgIHZhciByZXF1ZXN0ID0gbmF0aXZlT2JqZWN0W2Z1bmNOYW1lXS5hcHBseShuYXRpdmVPYmplY3QsIGFyZ3Muc2xpY2UoMCwgLTEpKTtcbiAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICBjYWxsYmFjayhyZXF1ZXN0LnJlc3VsdCk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgIH0pO1xuICB9KTtcblxuICAvLyBwb2x5ZmlsbCBnZXRBbGxcbiAgW0luZGV4LCBPYmplY3RTdG9yZV0uZm9yRWFjaChmdW5jdGlvbihDb25zdHJ1Y3Rvcikge1xuICAgIGlmIChDb25zdHJ1Y3Rvci5wcm90b3R5cGUuZ2V0QWxsKSByZXR1cm47XG4gICAgQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCA9IGZ1bmN0aW9uKHF1ZXJ5LCBjb3VudCkge1xuICAgICAgdmFyIGluc3RhbmNlID0gdGhpcztcbiAgICAgIHZhciBpdGVtcyA9IFtdO1xuXG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSkge1xuICAgICAgICBpbnN0YW5jZS5pdGVyYXRlQ3Vyc29yKHF1ZXJ5LCBmdW5jdGlvbihjdXJzb3IpIHtcbiAgICAgICAgICBpZiAoIWN1cnNvcikge1xuICAgICAgICAgICAgcmVzb2x2ZShpdGVtcyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGl0ZW1zLnB1c2goY3Vyc29yLnZhbHVlKTtcblxuICAgICAgICAgIGlmIChjb3VudCAhPT0gdW5kZWZpbmVkICYmIGl0ZW1zLmxlbmd0aCA9PSBjb3VudCkge1xuICAgICAgICAgICAgcmVzb2x2ZShpdGVtcyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGN1cnNvci5jb250aW51ZSgpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gIH0pO1xuXG4gIHZhciBleHAgPSB7XG4gICAgb3BlbjogZnVuY3Rpb24obmFtZSwgdmVyc2lvbiwgdXBncmFkZUNhbGxiYWNrKSB7XG4gICAgICB2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKGluZGV4ZWREQiwgJ29wZW4nLCBbbmFtZSwgdmVyc2lvbl0pO1xuICAgICAgdmFyIHJlcXVlc3QgPSBwLnJlcXVlc3Q7XG5cbiAgICAgIHJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgaWYgKHVwZ3JhZGVDYWxsYmFjaykge1xuICAgICAgICAgIHVwZ3JhZGVDYWxsYmFjayhuZXcgVXBncmFkZURCKHJlcXVlc3QucmVzdWx0LCBldmVudC5vbGRWZXJzaW9uLCByZXF1ZXN0LnRyYW5zYWN0aW9uKSk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIHJldHVybiBwLnRoZW4oZnVuY3Rpb24oZGIpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEQihkYik7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGRlbGV0ZTogZnVuY3Rpb24obmFtZSkge1xuICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3RDYWxsKGluZGV4ZWREQiwgJ2RlbGV0ZURhdGFiYXNlJywgW25hbWVdKTtcbiAgICB9XG4gIH07XG5cbiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBleHA7XG4gICAgbW9kdWxlLmV4cG9ydHMuZGVmYXVsdCA9IG1vZHVsZS5leHBvcnRzO1xuICB9XG4gIGVsc2Uge1xuICAgIHNlbGYuaWRiID0gZXhwO1xuICB9XG59KCkpO1xuIiwiY29uc3QgaWRiID0gcmVxdWlyZSgnaWRiJyk7XG5jb25zdCBJREJfREIgPSAncmVzdGF1cmFudC1kYic7XG5jb25zdCBJREJfUkVTVEFVUkFOVFMgPSAncmVzdGF1cmFudHMnO1xuY29uc3QgSURCX1BFTkRJTkdfUkVTVEFVUkFOVFMgPSAncGVuZGluZ19yZXN0YXVyYW50cyc7XG5jb25zdCBJREJfUkVWSUVXUyA9ICdyZXZpZXdzJztcbmNvbnN0IElEQl9QRU5ESU5HX1JFVklFV1MgPSAncGVuZGluZ19yZXZpZXdzJztcblxuY29uc3QgZGJQcm9taXNlID0gaWRiLm9wZW4oSURCX0RCLCAyLCBmdW5jdGlvbiAodXBncmFkZURiKSB7XG4gIHN3aXRjaCAodXBncmFkZURiLm9sZFZlcnNpb24pIHtcbiAgICBjYXNlIDA6XG4gICAgY2FzZSAxOlxuICAgIGNhc2UgMjpcbiAgICAgIGNvbnN0IHN0b3JlUmVzdGF1cmFudCA9IHVwZ3JhZGVEYi5jcmVhdGVPYmplY3RTdG9yZShJREJfUkVTVEFVUkFOVFMsIHtcbiAgICAgICAga2V5UGF0aDogJ2lkJ1xuICAgICAgfSk7XG4gICAgICBzdG9yZVJlc3RhdXJhbnQuY3JlYXRlSW5kZXgoJ2J5LWlkJywgJ2lkJywgeyB1bmlxdWU6IHRydWUgfSk7XG5cbiAgICAgIGNvbnN0IHN0b3JlUmV2aWV3cyA9IHVwZ3JhZGVEYi5jcmVhdGVPYmplY3RTdG9yZShJREJfUkVWSUVXUywge1xuICAgICAgICBrZXlQYXRoOiAnaWQnXG4gICAgICB9KTtcbiAgICAgIC8vc3RvcmVSZXZpZXdzLmNyZWF0ZUluZGV4KCdieS1pZCcsICdpZCcsIHsgdW5pcXVlOiB0cnVlIH0pO1xuICAgICAgc3RvcmVSZXZpZXdzLmNyZWF0ZUluZGV4KCdieS1yZXN0YXVyYW50LWlkJywgJ3Jlc3RhdXJhbnRfaWQnKTtcblxuICAgICAgY29uc3QgcGVuZGluZ1Jlc3RhdXJhbnRzID0gdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKElEQl9QRU5ESU5HX1JFU1RBVVJBTlRTLCB7XG4gICAgICAgIGtleVBhdGg6ICdpZCdcbiAgICAgIH0pO1xuICAgICAgcGVuZGluZ1Jlc3RhdXJhbnRzLmNyZWF0ZUluZGV4KCdieS1pZCcsICdpZCcsIHt1bmlxdWU6dHJ1ZX0pO1xuXG4gICAgICBjb25zdCBwZW5kaW5nUmV2aWV3cyA9IHVwZ3JhZGVEYi5jcmVhdGVPYmplY3RTdG9yZShJREJfUEVORElOR19SRVZJRVdTLCB7XG4gICAgICAgIGtleVBhdGg6J2lkJywgYXV0b0luY3JlbWVudDp0cnVlXG4gICAgICB9KTtcbiAgICAgIHBlbmRpbmdSZXZpZXdzLmNyZWF0ZUluZGV4KCdieS1pZCcsICdpZCcsIHt1bmlxdWU6dHJ1ZX0pO1xuICB9XG59KTtcblxuY29uc3Qgc3RhdGljQ2FjaGVOYW1lID0gJ213cy1yZXN0YXVyYW50LXN0YWdlLTMnO1xuXG5sZXQgZmlsZXNUb0NhY2hlID0gW1xuICAnLycsXG4gICdtYW5pZmVzdC5qc29uJyxcbiAgJ2luZGV4Lmh0bWwnLFxuICAncmVzdGF1cmFudC5odG1sJyxcbiAgJ2Nzcy9tYWluLmNzcycsXG4gICdjc3MvZGV0YWlsLmNzcycsXG4gICdqcy9idW5kbGVfbWFpbi5qcycsXG4gICdqcy9idW5kbGVfcmVzdGF1cmFudC5qcycsXG4gICdzdy5qcycsXG4gICdpbWcvZmF2aWNvbi9hcHBsZS1pY29uLTU3eDU3LnBuZycsXG4gICdpbWcvZmF2aWNvbi9hcHBsZS1pY29uLTYweDYwLnBuZycsXG4gICdpbWcvZmF2aWNvbi9hcHBsZS1pY29uLTcyeDcyLnBuZycsXG4gICdpbWcvZmF2aWNvbi9hcHBsZS1pY29uLTc2eDc2LnBuZycsXG4gICdpbWcvZmF2aWNvbi9hcHBsZS1pY29uLTExNHgxMTQucG5nJyxcbiAgJ2ltZy9mYXZpY29uL2FwcGxlLWljb24tMTIweDEyMC5wbmcnLFxuICAnaW1nL2Zhdmljb24vYXBwbGUtaWNvbi0xNDR4MTQ0LnBuZycsXG4gICdpbWcvZmF2aWNvbi9hcHBsZS1pY29uLTE1MngxNTIucG5nJyxcbiAgJ2ltZy9mYXZpY29uL2FwcGxlLWljb24tMTgweDE4MC5wbmcnLFxuICAnaW1nL2Zhdmljb24vYW5kcm9pZC1pY29uLTE5MngxOTIucG5nJyxcbiAgJ2ltZy9mYXZpY29uL2Zhdmljb24tMzJ4MzIucG5nJyxcbiAgJ2ltZy9mYXZpY29uL2Zhdmljb24tOTZ4OTYucG5nJyxcbiAgJ2ltZy9mYXZpY29uL2Zhdmljb24tMTZ4MTYucG5nJyxcbiAgJ2ltZy9mYXZpY29uL21zLWljb24tMTQ0eDE0NC5wbmcnLFxuICAnaW1nL2Zhdmljb24vbXMtaWNvbi03MHg3MC5wbmcnLFxuICAnaW1nL2Zhdmljb24vbXMtaWNvbi0xNTB4MTUwLnBuZycsXG4gICdpbWcvZmF2aWNvbi9tcy1pY29uLTMxMHgzMTAucG5nJyxcbiAgJ2ltZy9mYXZpY29uL2FuZHJvaWQtaWNvbi01MTJ4NTEyLnBuZycsXG4gICdpbWcvZmF2aWNvbi9mYXZpY29uLmljbycsXG4gICdpbWcvMS0zODBfc21hbGwuanBnJyxcbiAgJ2ltZy8xLTUxMl9tZWRpdW0uanBnJyxcbiAgJ2ltZy8xLTgwMF9sYXJnZS5qcGcnLFxuICAnaW1nLzItMzgwX3NtYWxsLmpwZycsXG4gICdpbWcvMi01MTJfbWVkaXVtLmpwZycsXG4gICdpbWcvMi04MDBfbGFyZ2UuanBnJyxcbiAgJ2ltZy8zLTM4MF9zbWFsbC5qcGcnLFxuICAnaW1nLzMtNTEyX21lZGl1bS5qcGcnLFxuICAnaW1nLzMtODAwX2xhcmdlLmpwZycsXG4gICdpbWcvNC0zODBfc21hbGwuanBnJyxcbiAgJ2ltZy80LTUxMl9tZWRpdW0uanBnJyxcbiAgJ2ltZy80LTgwMF9sYXJnZS5qcGcnLFxuICAnaW1nLzUtMzgwX3NtYWxsLmpwZycsXG4gICdpbWcvNS01MTJfbWVkaXVtLmpwZycsXG4gICdpbWcvNS04MDBfbGFyZ2UuanBnJyxcbiAgJ2ltZy82LTM4MF9zbWFsbC5qcGcnLFxuICAnaW1nLzYtNTEyX21lZGl1bS5qcGcnLFxuICAnaW1nLzYtODAwX2xhcmdlLmpwZycsXG4gICdpbWcvNy0zODBfc21hbGwuanBnJyxcbiAgJ2ltZy83LTUxMl9tZWRpdW0uanBnJyxcbiAgJ2ltZy83LTgwMF9sYXJnZS5qcGcnLFxuICAnaW1nLzgtMzgwX3NtYWxsLmpwZycsXG4gICdpbWcvOC01MTJfbWVkaXVtLmpwZycsXG4gICdpbWcvOC04MDBfbGFyZ2UuanBnJyxcbiAgJ2ltZy85LTM4MF9zbWFsbC5qcGcnLFxuICAnaW1nLzktNTEyX21lZGl1bS5qcGcnLFxuICAnaW1nLzktODAwX2xhcmdlLmpwZycsXG4gICdpbWcvMTAtMzgwX3NtYWxsLmpwZycsXG4gICdpbWcvMTAtNTEyX21lZGl1bS5qcGcnLFxuICAnaW1nLzEwLTgwMF9sYXJnZS5qcGcnLFxuXTtcblxuXG5zZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2luc3RhbGwnLCBmdW5jdGlvbihldmVudCkge1xuICBldmVudC53YWl0VW50aWwoXG4gICAgY2FjaGVzLm9wZW4oc3RhdGljQ2FjaGVOYW1lKS50aGVuKGZ1bmN0aW9uKGNhY2hlKSB7XG4gICAgICByZXR1cm4gY2FjaGUuYWRkQWxsKGZpbGVzVG9DYWNoZSk7XG4gICAgfSlcbiAgKTtcbn0pO1xuXG5cbnNlbGYuYWRkRXZlbnRMaXN0ZW5lcignYWN0aXZhdGUnLCBmdW5jdGlvbihldmVudCkge1xuICBldmVudC53YWl0VW50aWwoXG4gICAgY2FjaGVzLmtleXMoKS50aGVuKGZ1bmN0aW9uKGNhY2hlTmFtZXMpIHtcbiAgICAgIHJldHVybiBQcm9taXNlLmFsbChcbiAgICAgICAgY2FjaGVOYW1lcy5maWx0ZXIoZnVuY3Rpb24oY2FjaGVOYW1lKSB7XG4gICAgICAgICAgcmV0dXJuIGNhY2hlTmFtZS5zdGFydHNXaXRoKCdtd3MtJykgJiZcbiAgICAgICAgICAgICAgICAgY2FjaGVOYW1lICE9IHN0YXRpY0NhY2hlTmFtZTtcbiAgICAgICAgfSkubWFwKGZ1bmN0aW9uKGNhY2hlTmFtZSkge1xuICAgICAgICAgIHJldHVybiBjYWNoZXMuZGVsZXRlKGNhY2hlTmFtZSk7XG4gICAgICAgIH0pXG4gICAgICApLnRoZW4oKCkgPT4geyBjb25zb2xlLmxvZygnU2VydmljZSB3b3JrZXIgYWN0aXZlJyk7fSApO1xuICAgIH0pXG4gICk7XG59KTtcblxuXG5zZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2ZldGNoJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgZXZlbnQucmVzcG9uZFdpdGgoXG4gICAgY2FjaGVzLm1hdGNoKGV2ZW50LnJlcXVlc3QpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgIHJldHVybiByZXNwb25zZSB8fCBmZXRjaChldmVudC5yZXF1ZXN0KTtcbiAgICB9KVxuICApO1xufSk7XG5cblxuc2VsZi5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgaWYgKGV2ZW50LmRhdGEuYWN0aW9uID09PSAnc2tpcFdhaXRpbmcnKSB7XG4gICAgc2VsZi5za2lwV2FpdGluZygpO1xuICB9XG59KTtcblxuXG4vL0Jhc2VkIG9uIGh0dHBzOi8vZ2l0aHViLmNvbS9XSUNHL0JhY2tncm91bmRTeW5jL2Jsb2IvbWFzdGVyL2V4cGxhaW5lci5tZFxuc2VsZi5hZGRFdmVudExpc3RlbmVyKCdzeW5jJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgc3dpdGNoKGV2ZW50LnRhZykge1xuICAgIGNhc2UgJ3Jldmlldyc6ICBldmVudC53YWl0VW50aWwoc2VuZEFsbFJldmlld3MoKSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdmYXZvcml0ZSc6IGV2ZW50LndhaXRVbnRpbChzZW5kQWxsRmF2b3JpdGVzKCkpO1xuICAgICAgYnJlYWs7XG4gIH1cbn0pO1xuXG5cbi8qKlxuICogQGRlc2NyaXB0aW9uICBTZW5kIHJldmlldyB0byBzZXJ2ZXIgYW5kIHN0b3JlcyBpdCBhdCBkYXRhYmFzZS5cbiAqIEBjb25zdHJ1Y3RvclxuICogQHBhcmFtIHtvYmplY3R9IHJldmlldyAtIFJldml3ZSBvYmplY3QuXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayAtIENhbGxiYWNrIGZ1bmN0aW9uLlxuICovXG5mdW5jdGlvbiBwb3N0UmV2aWV3KHJldmlldykge1xuICByZXR1cm4gZmV0Y2goYGh0dHA6Ly9sb2NhbGhvc3Q6MTMzNy9yZXZpZXdzYCxcbiAgICB7XG4gICAgICBtZXRob2Q6J3Bvc3QnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBBY2NlcHQ6IFwiYXBwbGljYXRpb24vanNvbiwgdGV4dC9wbGFpbiwgKi8qXCIsXG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiXG4gICAgICB9LFxuICAgICAgYm9keTpKU09OLnN0cmluZ2lmeShyZXZpZXcpXG4gICAgfSlcbiAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXG4gICAgLnRoZW4ocmV2aWV3ID0+IGNvbnNvbGUubG9nKHJldmlldykpO1xufVxuXG5cbi8qKlxuICogQGRlc2NyaXB0aW9uICBTZW5kIHJldmlldyB0byBzZXJ2ZXIgYW5kIHN0b3JlcyBpdCBhdCBkYXRhYmFzZS5cbiAqIEBjb25zdHJ1Y3RvclxuICogQHBhcmFtIHtvYmplY3R9IHJldmlldyAtIFJldml3ZSBvYmplY3QuXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayAtIENhbGxiYWNrIGZ1bmN0aW9uLlxuICovXG5mdW5jdGlvbiBwdXRGYXZvcml0ZShmYXZvcml0ZSkge1xuICByZXR1cm4gZmV0Y2goYGh0dHA6Ly9sb2NhbGhvc3Q6MTMzNy9yZXN0YXVyYW50cy8ke2Zhdm9yaXRlLnJlc3RhdXJhbnRfaWR9Lz9pc19mYXZvcml0ZT0ke2Zhdm9yaXRlLmlzX2Zhdm9yaXRlfWAsXG4gICAge1xuICAgICAgbWV0aG9kOidwdXQnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBBY2NlcHQ6IFwiYXBwbGljYXRpb24vanNvbiwgdGV4dC9wbGFpbiwgKi8qXCIsXG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiXG4gICAgICB9LFxuICAgICAgYm9keTpKU09OLnN0cmluZ2lmeShmYXZvcml0ZSlcbiAgICB9KVxuICAgIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSlcbiAgICAudGhlbihmYXZvcml0ZSA9PiBjb25zb2xlLmxvZyhmYXZvcml0ZSkpO1xufVxuXG5cbi8qKlxuICogQGRlc2NyaXB0aW9uICBTZW5kIGFsbCByZXZpZXdzIHRvIHNlcnZlclxuICogQGNvbnN0cnVjdG9yXG4gKi9cbmZ1bmN0aW9uIHNlbmRBbGxSZXZpZXdzKCkge1xuICBkYlByb21pc2UudGhlbiggZGIgPT4ge1xuICAgIGlmKCFkYikgcmV0dXJuO1xuICAgIHJldHVybiBkYi50cmFuc2FjdGlvbihJREJfUEVORElOR19SRVZJRVdTKVxuICAgICAgICAgICAgIC5vYmplY3RTdG9yZShJREJfUEVORElOR19SRVZJRVdTKVxuICAgICAgICAgICAgIC5nZXRBbGwoKTtcbiAgfSlcbiAgLnRoZW4ocmV2aWV3cyA9PiB7XG4gICAgY29uc3QgcmV2aWV3TGlzdCA9IFtdO1xuICAgIHJldmlld3MuZm9yRWFjaChmdW5jdGlvbihyZXZpZXcpIHtcbiAgICAgIGxldCByZXYgPSB7XG4gICAgICAgICdyZXN0YXVyYW50X2lkJzogcmV2aWV3LnJlc3RhdXJhbnRfaWQsXG4gICAgICAgICduYW1lJzogcmV2aWV3Lm5hbWUsXG4gICAgICAgICdyYXRpbmcnOiByZXZpZXcucmF0aW5nLFxuICAgICAgICAnY29tbWVudHMnOiByZXZpZXcuY29tbWVudHMsXG4gICAgICAgICdjcmVhdGVkQXQnOiByZXZpZXcuY3JlYXRlZEF0LFxuICAgICAgICAndXBkYXRlZEF0JzogcmV2aWV3LnVwZGF0ZWRBdFxuICAgICAgfTtcbiAgICAgIHJldmlld0xpc3QucHVzaChwb3N0UmV2aWV3KHJldikpO1xuICAgIH0pO1xuICAgIHJldHVybiBQcm9taXNlLmFsbChyZXZpZXdMaXN0KTtcbiAgfSlcbiAgLnRoZW4ocmV2aWV3cyA9PiB7XG4gICAgZGJQcm9taXNlLnRoZW4oIGRiID0+IHtcbiAgICAgIGlmKCFkYikgcmV0dXJuO1xuICAgICAgY29uc3QgY2xlYXIgPSBkYi50cmFuc2FjdGlvbihJREJfUEVORElOR19SRVZJRVdTLCBcInJlYWR3cml0ZVwiKTtcbiAgICAgIGNsZWFyLm9iamVjdFN0b3JlKElEQl9QRU5ESU5HX1JFVklFV1MpLmNsZWFyKCk7XG4gICAgICByZXR1cm4gY2xlYXIuY29tcGxldGU7XG4gICAgfSlcbiAgfSlcbiAgLmNhdGNoKGVycm9yID0+IHtcbiAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgfSlcbn1cblxuXG4vKipcbiAqIEBkZXNjcmlwdGlvbiAgU2VuZCBhbGwgcmV2aWV3cyB0byBzZXJ2ZXJcbiAqIEBjb25zdHJ1Y3RvclxuICovXG5mdW5jdGlvbiBzZW5kQWxsRmF2b3JpdGVzKCkge1xuICBkYlByb21pc2UudGhlbiggZGIgPT4ge1xuICAgIGlmKCFkYikgcmV0dXJuO1xuICAgIHJldHVybiBkYi50cmFuc2FjdGlvbihJREJfUEVORElOR19SRVNUQVVSQU5UUylcbiAgICAgICAgICAgICAub2JqZWN0U3RvcmUoSURCX1BFTkRJTkdfUkVTVEFVUkFOVFMpXG4gICAgICAgICAgICAgLmdldEFsbCgpO1xuICB9KVxuICAudGhlbihmYXZvcml0ZXMgPT4ge1xuICAgIGNvbnN0IGZhdm9yaXRlTGlzdCA9IFtdO1xuICAgIGZhdm9yaXRlcy5mb3JFYWNoKGZ1bmN0aW9uKGZhdm9yaXRlKSB7XG4gICAgICBmYXZvcml0ZUxpc3QucHVzaChwdXRGYXZvcml0ZShmYXZvcml0ZSkpO1xuICAgIH0pO1xuICAgIHJldHVybiBQcm9taXNlLmFsbChmYXZvcml0ZUxpc3QpO1xuICB9KVxuICAudGhlbihmYXZvcml0ZXMgPT4ge1xuICAgIGRiUHJvbWlzZS50aGVuKCBkYiA9PiB7XG4gICAgICBpZighZGIpIHJldHVybjtcbiAgICAgIGNvbnN0IGNsZWFyID0gZGIudHJhbnNhY3Rpb24oSURCX1BFTkRJTkdfUkVTVEFVUkFOVFMsIFwicmVhZHdyaXRlXCIpO1xuICAgICAgY2xlYXIub2JqZWN0U3RvcmUoSURCX1BFTkRJTkdfUkVTVEFVUkFOVFMpLmNsZWFyKCk7XG4gICAgICByZXR1cm4gY2xlYXIuY29tcGxldGU7XG4gICAgfSlcbiAgfSlcbiAgLmNhdGNoKGVycm9yID0+IHtcbiAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgfSlcbn1cbiJdfQ=="}